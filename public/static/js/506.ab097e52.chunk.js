"use strict";(self.webpackChunksocial_network_app=self.webpackChunksocial_network_app||[]).push([[506],{7506:(e,t,s)=>{s.r(t),s.d(t,{default:()=>O});var n=s(8683),a=s(2791),o=s(9434),r=s(262),i=s(1363),l=function(e,t){(t=t.current.element).observer&&(t.observer.disconnect(),t.prevWidth=null,t.prevHeight=null,t.observer=null)},c=function(e){var t=window.getComputedStyle(e);e=parseInt(t.height),t="normal"===t.lineHeight?1.2*parseInt(t.fontSize):parseInt(t.lineHeight);return 0===e&&0===t?0:Math.ceil(e/t)},d="css",h=3,u=!0,m=".\u200a.\u200a.",g=function(e,t){var s=(n=t.current).options,n=n.element;"css"!==s.method?"js"===s.method&&(function(e,t){var s,n=(t=t.current).options;t=t.element,e.current.style.display=null,e.current.style.webkitLineClamp=null,e.current.style.webkitBoxOrient=null,e.current.style.overflow=null,e.current.textContent=t.fullText,n.lines<=0||c(e.current)<=n.lines||(s={unprocessed:t.fullText,processed:""},(n.midWord?[". ",", "," ",""]:[". ",", "," "]).forEach((function(t){for(var a=0,o=s.unprocessed.split(t);a<o.length;a++){var r=o[a];if(e.current.textContent=""+s.processed+r+t+n.ellipsis,c(e.current)>n.lines){s.unprocessed=r;break}s.processed=""+s.processed+r+t}})),e.current.textContent=""+s.processed.trim()+n.ellipsis)}(e,t),n.prevWidth=e.current.clientWidth,n.prevHeight=e.current.clientHeight):function(e,t){t=(s=t.current).options;var s=s.element;e.current.textContent=s.fullText,e.current.style.display="-webkit-box",e.current.style.webkitLineClamp=""+t.lines,e.current.style.webkitBoxOrient="vertical",e.current.style.overflow="hidden"}(e,t)},f=function(e,t){var s=(0,a.useRef)({});(0,a.useLayoutEffect)((function(){s.current.options=function(e){var t;return{method:"undefined"!=typeof CSS&&CSS.supports("display","-webkit-box")&&CSS.supports("-webkit-line-clamp","3")&&CSS.supports("-webkit-box-orient","vertical")?null!==(t=null==e?void 0:e.method)&&void 0!==t?t:d:"js",lines:null!==(t=null==e?void 0:e.lines)&&void 0!==t?t:h,midWord:null!==(t=null==e?void 0:e.midWord)&&void 0!==t?t:u,ellipsis:null!==(e=null==e?void 0:e.ellipsis)&&void 0!==e?e:m}}(t)}),[t]),(0,a.useLayoutEffect)((function(){s.current.element={fullText:e.current.textContent}}),[e]),(0,a.useLayoutEffect)((function(){var t="undefined"!=typeof ResizeObserver,n="js"===s.current.options.method,a=!!s.current.element.observer,o=t&&n&&!a;n=t&&!n&&a;return o&&function(e,t){var s=t.current.element,n=s.observer||new ResizeObserver((function(){e.current.clientWidth===s.prevWidth&&e.current.clientHeight===s.prevHeight||g(e,t)}));n.observe(e.current),s.observer=n}(e,s),n&&l(0,s),o||g(e,s),function(){return a&&l(0,s)}}),[e,s.current.options])},v=function(e){var t=e.children,s=e.method,n=e.lines,o=e.midWord,r=(e=e.ellipsis,(0,a.useRef)(null));f(r,{method:s,lines:n,midWord:o,ellipsis:e});var i=function(e){return 1<a.Children.count(e)||!(0,a.isValidElement)(e)?a.createElement("div",{ref:r},e):(0,a.isValidElement)(e.props.children)?(0,a.cloneElement)(e,{children:i(e.props.children)}):(0,a.cloneElement)(e,{ref:r})};return i(t)},p=s(5478),x=s(184);function C(e){var t,s,n;let{chat:r,chats:i,setMessagesToShow:l,setChatWith:c,chatWith:d,chooseenChatId:h,setChooseenChatId:u,getTheNotLoggedUserChat:m}=e;const[g,f]=(0,a.useState)(null),[C,j]=(0,a.useState)(0),{unreadMessages:N}=(0,o.v9)((e=>e.activityModule)),S=(null===(t=r.messages[(null===(s=r.messages)||void 0===s?void 0:s.length)-1])||void 0===t?void 0:t.txt)||"No Messages yet..",w=new Date((null===(n=r.messages[0])||void 0===n?void 0:n.createdAt)||r.createdAt),I=w.toLocaleDateString().slice(0,-5);(0,a.useEffect)((()=>((async e=>{const t=await m(e);f(t)})(r),(()=>{let e=0;N.forEach((t=>{r._id===t&&e++})),j(e)})(),()=>{})),[]),(0,a.useEffect)((()=>(l(r.messages),u(r._id),()=>{})),[r,i]);const T=h===r._id?"chooseen-chat":"",y="container ".concat(T);return g?(0,x.jsx)("section",{className:"msg-preview",onClick:()=>{l(r.messages),c(g),u(r._id)},children:(0,x.jsxs)("div",{className:y,children:[(0,x.jsxs)("div",{className:"img-container",children:[(0,x.jsx)("img",{src:null===g||void 0===g?void 0:g.imgUrl,alt:"",className:"img"}),C>0&&(0,x.jsx)("span",{className:"number",children:(0,x.jsx)("p",{children:C})})]}),(0,x.jsxs)("div",{className:"details",children:[(0,x.jsxs)("div",{className:"fullname",children:[(0,x.jsx)("h1",{children:null===g||void 0===g?void 0:g.fullname}),(0,x.jsx)("span",{title:w,children:(0,x.jsx)(v,{lines:1,method:"css",children:I})})]}),(0,x.jsx)("div",{className:"last-msg",children:(0,x.jsx)(v,{lines:1,method:"css",children:(0,x.jsx)("p",{children:S})})})]})]})}):(0,x.jsx)("div",{className:"msg-preview",children:(0,x.jsx)("span",{className:"loading-circle",children:(0,x.jsx)("img",{src:p,alt:""})})})}function j(e){let{chats:t,setMessagesToShow:s,setChatWith:n,chatWith:o,setChooseenChatId:r,chooseenChatId:l,getTheNotLoggedUserChat:c,setTheNotLoggedUserChat:d,theNotLoggedUserChat:h}=e;const[u,m]=(0,a.useState)(null),[g,f]=(0,a.useState)({txt:""}),v=e=>{const s=new RegExp(e,"i"),n=[...t].filter((e=>s.test(e.users[0])||s.test(e.users[1])));m(n)};return(0,a.useEffect)((()=>{m([...t])}),[t]),(0,x.jsxs)("section",{className:"list-msg",children:[(0,x.jsxs)("div",{className:"title-container",children:[(0,x.jsx)("p",{children:"Messaging"}),(0,x.jsxs)("div",{className:"logos",children:[(0,x.jsx)("span",{className:"logo-menu",children:(0,x.jsx)(i.G,{className:"dots-icon",icon:"fa-solid fa-ellipsis"})}),(0,x.jsx)("span",{className:"logo-new-msg",children:(0,x.jsx)(i.G,{icon:"fa-solid fa-message"})})]})]}),(0,x.jsx)("div",{className:"filter-container",children:(0,x.jsx)("input",{onChange:async e=>{let{target:t}=e;const s=t.name;let n="number"===t.type?+t.value||"":t.value;f({[s]:n}),v(n)},type:"text",id:"txt",name:"txt",value:g.txt,placeholder:"Search messages"})}),(0,x.jsx)("div",{className:"list",children:u&&u.map((e=>(0,x.jsx)(C,{chat:e,chats:t,setMessagesToShow:s,setChatWith:n,chatWith:o,setChooseenChatId:r,getTheNotLoggedUserChat:c,setTheNotLoggedUserChat:d,theNotLoggedUserChat:h,chooseenChatId:l},e._id)))})]})}var N=s(8874),S=s(773),w=s(8931);function I(e){let{msg:t}=e;const[s,n]=(0,a.useState)(null),o=(0,w.k6)();return(0,a.useEffect)((()=>{(async e=>{if(!t)return;const s=await N.W.getById(e);n((()=>s))})(t.userId)}),[]),(0,x.jsxs)("section",{className:"thread-msg-preview",children:[(0,x.jsxs)("div",{className:"container-msg",children:[(0,x.jsx)("div",{className:"img-container",onClick:()=>o.push("/main/profile/".concat(null===s||void 0===s?void 0:s._id)),children:(null===s||void 0===s?void 0:s.imgUrl)&&(0,x.jsx)("img",{src:(null===s||void 0===s?void 0:s.imgUrl)||"",alt:"",className:"img"})||(0,x.jsx)("img",{src:p,className:"img",alt:""})}),(0,x.jsxs)("div",{className:"name-time-container",children:[(0,x.jsx)("div",{className:"fullname",children:(0,x.jsx)("h3",{children:null===s||void 0===s?void 0:s.fullname})}),(0,x.jsx)("div",{className:"time",children:(0,x.jsx)("span",{children:(0,x.jsx)(S.Z,{date:t.createdAt})})})]})]}),(0,x.jsx)("div",{className:"the-msg",children:(0,x.jsx)("p",{children:t.txt})})]})}function T(e){let{messagesToShow:t}=e;return null!==t&&void 0!==t&&t.length?(0,x.jsx)("section",{className:"thread-msg-list",children:(0,x.jsx)("div",{className:"list",children:t.map((e=>(0,x.jsx)(I,{msg:e},e._id)))})}):(0,x.jsx)("div",{children:"No msgs yet.."})}function y(e){let{onSendMsg:t,messagesToShow:s}=e;const[o,r]=(0,a.useState)({txt:""});return(0,a.useEffect)((()=>(r({txt:""}),()=>{})),[s]),(0,x.jsxs)("form",{className:"send-msg-container",onSubmit:e=>{e.preventDefault(),t(o.txt),r({txt:""})},children:[(0,x.jsx)("div",{className:"input-container",children:(0,x.jsx)("textarea",{ref:e=>{e&&e.focus()},required:!0,onChange:async e=>{const t=e.target.name;let s="number"===e.target.type?+e.target.value||"":e.target.value;r((e=>(0,n.Z)((0,n.Z)({},e),{},{[t]:s})))},type:"text",placeholder:"Write a message...",id:"txt",name:"txt",value:o.txt})}),(0,x.jsx)("div",{className:"btns-container",children:(0,x.jsx)("button",{children:"Send"})})]})}function b(e){let{messagesToShow:t,setMessagesToShow:s,chatWith:n,onSendMsg:o}=e;const r=(0,w.k6)();(0,a.useEffect)((()=>(l(),()=>{})),[t]);const l=()=>{var e=document.querySelector(".user-profile-details");e.scrollTop=e.scrollHeight};return(0,x.jsxs)("section",{className:"message-thread",children:[(0,x.jsxs)("header",{className:"header-message-thread",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"img-profile",onClick:()=>r.push("/main/profile/".concat(null===n||void 0===n?void 0:n._id)),children:(0,x.jsx)("img",{src:null===n||void 0===n?void 0:n.imgUrl,alt:"",className:"img"})}),(0,x.jsx)("div",{className:"fullname",children:null===n||void 0===n?void 0:n.fullname})]}),(0,x.jsx)("div",{className:"container-logo",children:(0,x.jsx)("span",{className:"logo-menu",children:(0,x.jsx)(i.G,{icon:"fa-solid fa-x",className:"dots-icon",onClick:()=>{s(null)}})})})]}),(0,x.jsx)("div",{className:"user-profile-details scroll-area",children:(0,x.jsx)(T,{messagesToShow:t})}),(0,x.jsx)(y,{onSendMsg:o,messagesToShow:t})]})}function M(e){let{chats:t,chatWith:s,messagesToShow:n,setMessagesToShow:a,chooseenChatId:o,setChooseenChatId:r,setChatWith:i,getTheNotLoggedUserChat:l,setTheNotLoggedUserChat:c,theNotLoggedUserChat:d,onSendMsg:h}=e;return(0,x.jsx)("section",{className:"messaging",children:(0,x.jsxs)("div",{className:"container",children:[(0,x.jsx)(j,{chats:t,setMessagesToShow:a,setChatWith:i,chatWith:s,setChooseenChatId:r,chooseenChatId:o,getTheNotLoggedUserChat:l,setTheNotLoggedUserChat:c,theNotLoggedUserChat:d}),n&&(0,x.jsx)(b,{messagesToShow:n,chatWith:s,onSendMsg:h,setMessagesToShow:a})]})})}var U=s(9247),W=s(6581),_=s(6695),L=s(9722),k=s(4029);function E(e,t,s){const r=(0,o.I0)(),[i,l]=(0,a.useState)(void 0),[c,d]=(0,a.useState)(null),[h,u]=(0,a.useState)(null),[m,g]=(0,a.useState)(!1),[f,v]=(0,a.useState)(null),[p,x]=(0,a.useState)(null),C=async t=>{if(!t||!e)return null;let s;return e._id!==t.userId?s=t.userId:e._id!==t.userId2&&(s=t.userId2),await N.W.getById(s)||null},j=async e=>{const t=await C(e)||null;v(t),x(t)};return{isUserChatExist:i,setIsUserChatExist:l,messagesToShow:c,setMessagesToShow:d,chooseenChatId:h,setChooseenChatId:u,theNotLoggedUserChat:f,setTheNotLoggedUserChat:v,chatWith:p,setChatWith:x,checkIfChatExist:()=>new Promise(((e,n)=>{if(!t)return n(!1);const a=t.some((e=>e.userId===s.userId||e.userId2===s.userId));a?e(a):n(a)})),openChat:async()=>{if(!0===i){const e=(n=s.userId,t.find((e=>e.userId===n||e.userId2===n)));await j(e),u(e._id),d(e.messages)}else if(!1===i){if(!s.userId||!t)return;const n=(t=>({_id:W.Y.makeId(7),userId:t,userId2:null===e||void 0===e?void 0:e._id,messages:[],createdAt:(new Date).getTime()}))(s.userId);r((0,U.dF)(n)),g(!0),await j(n),u(n._id),d(n.messages)}var n},onSendMsg:s=>{const a=(t=>({_id:W.Y.makeId(24),txt:t,userId:e._id,createdAt:(new Date).getTime()}))(s),o=t.findIndex((e=>e._id===h)),i=(0,n.Z)({},t[o]);i.messages.push(a),i.users=[null===e||void 0===e?void 0:e.fullname,null===f||void 0===f?void 0:f.fullname],m&&(r((0,U.cy)(i._id)),delete i._id),g(!1),r((0,U.l_)(i)).then((t=>{if(d(t.messages),t){const s={type:"private-message",createdBy:null===e||void 0===e?void 0:e._id,createdTo:e._id===t.userId?t.userId2:t.userId,chatId:t._id};r((0,_.d_)(s))}}))},getTheNotLoggedUserChat:C}}const O=function(){const e=(0,o.I0)(),t=(0,w.UO)(),{loggedInUser:s}=(0,o.v9)((e=>e.userModule)),{chats:i}=(0,o.v9)((e=>e.chatModule)),{isUserChatExist:l,setIsUserChatExist:c,messagesToShow:d,setMessagesToShow:h,chooseenChatId:u,setChooseenChatId:m,theNotLoggedUserChat:g,setTheNotLoggedUserChat:f,chatWith:v,setChatWith:p,checkIfChatExist:C,openChat:j,onSendMsg:N,getTheNotLoggedUserChat:S}=E(s,i,t);(0,a.useEffect)((()=>{e((0,r.rd)("message"));const n=null===s||void 0===s?void 0:s._id;n&&e((0,U.Ir)(n)).then((()=>{C().then((e=>{t.userId!==s._id&&(c(e),j())})).catch((e=>{t.userId!==s._id&&(c(e),j())}))}))}),[s,t.userId,l]),(0,a.useEffect)((()=>async()=>{await I(),e((0,_.T7)())}),[]);const I=async()=>{const t=(new Date).getTime();await e((0,k.Nq)((0,n.Z)((0,n.Z)({},s),{},{lastSeenMsgs:t})))};return i?(0,x.jsxs)("section",{className:"message-page",children:[(0,x.jsx)(M,{chats:i,messagesToShow:d,setMessagesToShow:h,chooseenChatId:u,setChooseenChatId:m,chatWith:v,setChatWith:p,getTheNotLoggedUserChat:S,setTheNotLoggedUserChat:f,theNotLoggedUserChat:g,onSendMsg:N}),(0,x.jsx)("div",{className:"right-side-message",children:(0,x.jsx)("p",{children:"This ad could be yours"})})]}):(0,x.jsx)("div",{className:"message-page",children:(0,x.jsx)("div",{className:"gif-container",children:(0,x.jsx)("img",{className:"loading-gif",src:L,alt:""})})})}},6581:(e,t,s)=>{s.d(t,{Y:()=>n});const n={makeId:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;for(var t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n++)t+=s.charAt(Math.floor(Math.random()*s.length));return t},debounce:function(e,t){let s;return function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];const r=()=>{clearTimeout(s),e(...a)};clearTimeout(s),s=setTimeout(r,t)}},getRandomInt:a,getRandomColor:function(){for(var e="#",t=0;t<6;t++)e+=Math.floor(10*Math.random());return e},getLoremIpsum:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=["The sky","above","the port","was","the color of television","tuned","to","a dead channel",".","All","this happened","more or less",".","I","had","the story","bit by bit","from various people","and","as generally","happens","in such cases","each time","it","was","a different story",".","It","was","a pleasure","to","burn"];let s="";for(;e>0;)s+=t[a(0,t.length-1)]+" ",e--;return s+=".",s.trim()},loadFromStorage:function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null},saveToStorage:function(e,t){localStorage[e]=JSON.stringify(t)},loadFromSessionStorage:function(e){var t=sessionStorage.getItem(e);return t?JSON.parse(t):null},saveToSessionStorage:function(e,t){sessionStorage[e]=JSON.stringify(t)},delay:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500;return new Promise((t=>{setTimeout(t,e)}))}};function a(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}},773:(e,t,s)=>{s.d(t,{Z:()=>f});var n=s(8683),a=s(5987),o=s(2791);function r(e){const t=new Date(e);if(!Number.isNaN(t.valueOf()))return t;const s=String(e).match(/\d+/g);if(null==s||s.length<=2)return t;{const[e,t,...n]=s.map((e=>parseInt(e))),a=[e,t-1,...n];return new Date(Date.UTC(...a))}}function i(e,t,s){return e+" "+(1!==e?t+"s":t)+" "+s}const l=["date","formatter","component","live","minPeriod","maxPeriod","title","now"];function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},c.apply(this,arguments)}const d=3600,h=86400,u=7*h,m=30*h,g=365*h;function f(e){let{date:t,formatter:s=i,component:f="time",live:v=!0,minPeriod:p=0,maxPeriod:x=u,title:C,now:j=(()=>Date.now())}=e,N=(0,a.Z)(e,l);const[S,w]=(0,o.useState)(j());(0,o.useEffect)((()=>{if(!v)return;const e=(()=>{const e=r(t).valueOf();if(!e)return console.warn("[react-timeago] Invalid Date provided"),0;const s=Math.round(Math.abs(S-e)/1e3),n=s<60?1e3:s<d?6e4:s<h?36e5:1e3*u,a=Math.min(Math.max(n,1e3*p),1e3*x);return a?setTimeout((()=>{w(j())}),a):0})();return()=>{e&&clearTimeout(e)}}),[t,v,x,p,j,S]);const I=f,T=r(t).valueOf();if(!T)return null;const y=Math.round(Math.abs(S-T)/1e3),b=T<S?"ago":"from now",[M,U]=y<60?[Math.round(y),"second"]:y<d?[Math.round(y/60),"minute"]:y<h?[Math.round(y/d),"hour"]:y<u?[Math.round(y/h),"day"]:y<m?[Math.round(y/u),"week"]:y<g?[Math.round(y/m),"month"]:[Math.round(y/g),"year"],W="undefined"===typeof C?"string"===typeof t?t:r(t).toISOString().substr(0,16).replace("T"," "):C,_="time"===I?(0,n.Z)((0,n.Z)({},N),{},{dateTime:r(t).toISOString()}):N,L=i.bind(null,M,U,b);return o.createElement(I,c({},_,{title:W}),s(M,U,b,T,L,j))}},5478:(e,t,s)=>{e.exports=s.p+"static/media/loading-circle.b8e847dbc0e0c5799a06.gif"}}]);
//# sourceMappingURL=506.ab097e52.chunk.js.map